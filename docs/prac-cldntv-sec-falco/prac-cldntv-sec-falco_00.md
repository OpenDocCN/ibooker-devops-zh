# 前言

现代计算堆栈的出现彻底改变了我们对安全性的看法。在旧的数据中心时代，安全从业者把软件应用程序看作是中世纪城堡：保护它们需要建造高墙和小而精密的入口。现代基于云的软件看起来更像是一个繁华的现代城市：人们在其内部自由移动，并跨越其界限消费和提供服务，买卖、建设和修复事物。

正如今天的城市规划师所知道的那样，仅有大墙和守卫的入口是不足以保护一个城市的。更好的方法包括广泛而细化的可见性：例如一个安全摄像头网络，以及能够查看它们的录像并实时响应它们捕捉到的任何威胁。

本书讲述的是现代应用程序的安全性，使用业界广泛接受的开源工具，被称为云原生堆栈的“安全摄像头”：Falco。Falco 是一个云原生运行时安全项目，旨在通过实时检测意外行为、入侵和数据窃取来保护在云中运行的软件。它是 Kubernetes 和云基础设施的事实上的威胁检测引擎，被无数用户部署在从单机测试环境到全球最大的计算环境之一的各种场景中。我们将教会你如何通过检测工作负载和它们所操作的云基础设施中的威胁和配置错误来保护应用程序在运行时的安全性。

本书有一个非常实际的目标：为您提供在任何规模的环境中成功部署运行时安全性所需的知识，使用 Falco。当您读完本书时，您将对 Falco 的工作原理有扎实的理解：您将能够在任何环境中安装它，调整其性能，根据您的需求自定义它，收集和解释其数据，甚至扩展它。

# 本书适合谁？

我们主要为希望在其现代计算环境中生产中实施运行时安全性和威胁检测的安全操作员和架构师编写了本书。然而，我们设计本书，即使是对领域中有限或没有经验的读者也很友好。因此，我们只要求您熟悉最重要的云计算服务、容器和 Kubernetes 即可。

我们还将涵盖像规模部署、优化和规则编写等更高级的主题，即使是专家用户也会觉得有用。因此，即使您熟悉运行时安全性，或者已经在使用 Falco，本书也将帮助您提升水平。书的后半部分需要了解像 Go 这样的编程语言的基础知识。希望扩展或自定义 Falco 的开发人员将在这里找到很大的价值。最后，我们将本书的最后一章针对那些考虑成为 Falco 贡献者的人——我们希望能激励您加入他们！

# 概述

本书分为四个部分，按照递增复杂性的顺序组织，每个部分都建立在前一个部分的基础上。为了帮助你了解，让我们来看看每个部分的内容。

## 第一部分：基础知识

第一部分介绍了 Falco 的定义及其功能。在这里，我们将教你 Falco 背后的基本概念，并指导你完成首次本地部署：

+   第一章，“介绍 Falco”，概述了 Falco 的定义，包括其功能的高级视图以及各个组件的简介描述。本章包括了 Falco 的简要历史以及启发它的工具的介绍。

+   第二章，“在本地机器上开始使用 Falco”，指导你如何在本地 Linux 系统上安装单个 Falco 实例的过程。本章包括如何运行 Falco 并生成你的第一个通知输出的说明。

## 第二部分：Falco 的架构

第二部分将教你了解 Falco 架构及其内部工作的复杂性：

+   第三章，“理解 Falco 的架构”，深入探讨了 Falco 传感器的细节、数据收集过程及其涉及的组件。本章带给你的架构理解将成为本书其余部分的基础。

+   第四章，“数据源”，介绍了 Falco 中可以使用的两种主要数据源：系统调用和插件。我们解释了这些数据源产生的数据内容，数据如何收集以及 Falco 收集栈与替代方法的比较。

+   第五章，“数据增强”，涵盖了 Falco 用于增强其收集的数据的技术。增强包括向收集的数据添加上下文信息的层级；例如，容器 ID、Kubernetes 标签或云提供商标签。本章解释了如何配置 Falco 以收集增强元数据以及如何自定义它以添加你自己的元数据。

+   第六章，“字段和过滤器”，涵盖了 Falco 中最重要的概念之一——过滤引擎及其基础字段。本章结构化地介绍了语言语法（包括操作符）和字段作为参考。

+   第七章，“Falco 规则”，介绍了规则及其语法，包括列表和宏等结构，这些在定制 Falco 时会经常用到。

+   第八章，“输出框架”，描述了 Falco 用于将通知传递到输出通道的机制以及 Falco 可用的通道，并教你如何配置和使用它们。

## 第三部分：在生产环境中运行 Falco

第 III 部分 是严肃的 Falco 用户的参考手册。本书的这一部分将教会您在任何环境中部署、配置、运行和调优 Falco 的所有知识：

+   第九章，“安装 Falco”，介绍了在生产环境中安装 Falco 的方法，提供了详细说明。

+   第十章，“配置和运行 Falco”，详细介绍了 Falco 的配置系统如何运作。本章将帮助您理解和使用 Falco 的设置，包括命令行选项、环境变量、配置文件和规则文件。

+   第十一章，“使用 Falco 进行云安全”，提供了云安全的概述，然后深入讲解了使用 Falco 的 CloudTrail 插件进行 AWS 威胁检测的具体细节。采用实用的方法，并提供了在您的环境中使用 Falco 设置云安全的清晰完整说明。

+   第十二章，“消费 Falco 事件”，关注于您如何处理 Falco 的检测结果。涵盖了帮助您处理 Falco 输出的工具，如 falco-explorer 和 Falcosidekick，并帮助您了解哪些 Falco 事件对观察和分析是有用的，以及如何处理它们。

## 第四部分：扩展 Falco

第 IV 部分 是开发者的参考，涵盖了扩展 Falco 的方法：

+   第十三章，“编写 Falco 规则”，讲述了定制和扩展 Falco 检测的方法。您将学习如何编写新规则以及调整现有规则以满足您的需求。除了规则编写的基础知识外，本章还涵盖了噪声减少、性能优化和标记等高级主题。

+   第十四章，“Falco 开发”，介绍了如何与 Falco 的源代码一起工作。首先概述了代码库，然后深入探讨了两种扩展 Falco 的重要方法：使用 gRPC API 和插件框架。本章包含了几个示例，供您作为编程探险的基础。

+   第十五章，“如何贡献”，讨论了 Falco 社区并展示了如何为其做出贡献。如果您在读完全书后和我们一样对 Falco 深感兴奋，这是理想的阅读材料！

# 本书使用的约定

本书中使用以下排版约定：

*斜体*

表示新术语、URL、电子邮件地址、文件名和文件扩展名。

`等宽字体`

用于命令行输入和程序清单，以及段落内用于引用命令和程序元素，如变量或函数名称、数据类型和环境变量。

`**常量宽度粗体**`

显示用户应该按字面意义输入的命令或其他文本。在程序清单中偶尔用于突出感兴趣的文本。

`*常数宽度斜体*`

显示应由用户提供的值或由上下文确定的值替换的文本。

###### 提示

此元素表示提示或建议。

###### 注意

此元素表示一般注释。

###### 警告

此元素指示警告或注意事项。

# 使用代码示例

来自第十四章的代码示例可在[*https://oreil.ly/practical-cloud-native-security-falco-code*](https://oreil.ly/practical-cloud-native-security-falco-code)下载。

如果您有技术问题或在使用代码示例时遇到问题，请发送电子邮件至*bookquestions@oreilly.com*。

本书旨在帮助您完成工作。一般情况下，如果本书提供了示例代码，您可以在您的程序和文档中使用它。除非您复制了代码的大部分，否则您无需征得我们的许可。例如，编写一个使用本书中几个代码片段的程序不需要许可。出售或分发包含 O’Reilly 书籍示例的 CD-ROM 需要许可。引用本书并引用示例代码回答问题不需要许可。将本书中大量示例代码整合到您产品的文档中需要许可。

我们感谢您的提及，但并不要求署名。通常包括标题、作者、出版商和 ISBN。例如：“*Practical Cloud Native Security with Falco*，由 Loris Degioanni 和 Leonardo Grasso 编写（O’Reilly）。版权所有 2022 年 O’Reilly Media, Inc.，978-1-098-11857-0。”

如果您认为您对代码示例的使用超出了合理使用范围或上述许可，请随时联系我们：permissions@oreilly.com。

# O’Reilly 在线学习

超过 40 年来，O’Reilly Media 为提供技术和商业培训、知识和见解，帮助公司取得成功。

我们独特的专家和创新者网络通过书籍、文章和我们的在线学习平台分享他们的知识和专长。O’Reilly 的在线学习平台为您提供按需访问的实时培训课程、深入的学习路径、交互式编码环境，以及来自 O’Reilly 和其他 200 多个出版商的广泛的文本和视频。更多信息，请访问[*http://oreilly.com*](http://oreilly.com/)。

# 如何联系我们

请将有关本书的评论和问题发送给出版商：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   Sebastopol, CA 95472

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

我们为本书准备了一个网页，列出勘误、示例和任何额外信息。您可以访问[*https://oreil.ly/practical-cloud-native-security-falco*](https://oreil.ly/practical-cloud-native-security-falco)。

发送电子邮件至*bookquestions@oreilly.com*，以评论或提出关于本书的技术问题。

获取有关我们的书籍和课程的新闻和信息，请访问[*https://oreilly.com*](https://oreilly.com)。

在 LinkedIn 上找到我们：[*https://linkedin.com/company/oreilly-media*](https://linkedin.com/company/oreilly-media)

在 Twitter 上关注我们：[*https://twitter.com/oreillymedia*](https://twitter.com/oreillymedia)

在 YouTube 上关注我们：[*https://www.youtube.com/oreillymedia*](https://www.youtube.com/oreillymedia)

# 致谢

首先，我们要由衷感谢 Falco 社区：那些投入无数小时运营和发展项目的维护者们，他们怀着无比的激情；那些大小贡献者，每天让 Falco 变得更好；那些给予 Falco 机会并提供宝贵反馈的采纳者和倡导者。毫无疑问，Falco 是你们的爱和才华的结晶，如果这本书能展示你们的不凡工作，将是我们的荣幸。

还要感谢 Cloud Native Computing Foundation，为 Falco 提供一个良好的家园并支持其成长。

我们还要感谢在写作过程中帮助和支持我们的人们：特别是我们的项目经理 Tammy Yue 和我们的 O’Reilly 编辑 Sarah Grey。你们不仅非常专业和乐于助人，而且极为亲切、建设性和耐心。能够与你们合作是一种真正的愉悦。

最后，这本书得益于我们共同工作的公司 Sysdig 的支持才得以问世。我们真心感激能够为一个不仅理解而且积极支持开源，并且认同我们对未来安全性的开放信念的组织工作。

## Leonardo

有一天，我和 Loris 正在交谈时，他提议我们一起写一本书。所以在这里，我首先要感谢他。和他一起开展这个想法是我人生中最具挑战性但同时也最有趣的事情之一。我们会再做一次吗？作为第一次作者，写这本书对我来说是一次令人难以置信的新冒险，没有家人的帮助和爱，这是不可能的。因此，我要感谢我闪耀而心爱的 Ada，她一直支持我，并且赐给我我们的小米开罗。我也要感谢我们的小男孩，在他的妈妈完成写作后立刻出生。还有我的玛~（读作“玛蒂尔德”，我们的小猫在我写作时陪伴我轻声呼噜），他们在这段旅程中以耐心和欢乐陪伴着我。

最后但同样重要的是，我还要由衷感谢我的父母、姐妹和叔伯们。他们一直相信我，支持我，并在我需要时帮助我。没有他们，我无法走到今天。

## Loris

我要感谢我生命中的爱人 Stacey，我的妻子，感谢她对我所做的一切的耐心支持。感谢你在这本书的制作过程中没有让我挨饿、淹死或者遭受其他伤害。

我还要感谢我的三个孩子，Josephine、Vincenzo 和 August，你们给我生活的每一分钟带来了幸福，包括参与这本出版物的时间。你们频繁的问题和打扰使得写作本书更具挑战性，但也更加愉快。我期待着你们长大后将要出版的书籍。

我要感谢我的父母，在我事业起步之前和之后一直支持我。如果没有你们多年前种下并用爱和慷慨浇灌的种子，今天我不会在这里撰写这篇序言。

这本书如果没有我的合著者 Leo，将不可能问世。我们俩花了*大量*时间一起完成这项工作，每一分钟都是愉快、富有建设性和乐趣的。Leo，我期待着未来与你一起投入更多有趣和雄心勃勃的项目中。
