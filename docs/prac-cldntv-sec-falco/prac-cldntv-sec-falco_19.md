# 第十五章：如何贡献

到达本书的这一部分意味着你正在掌握 Falco 的所有方面。本章将为你提供一些建议，帮助你贡献给 Falco 项目。贡献意味着不仅仅是编写代码（这是一个常见的误解） —— 实际上，有许多有价值的贡献方式。我们将解释从何处开始以及如何满足 Falcosecurity 组织的特定贡献要求。

参与开源软件是一种有益的体验。你不仅可以改进 Falco，还会结识志同道合的人，与他人分享反馈和想法，提升自己的技能。如果你是开源新手或者想了解更多，我们建议你参阅[开源指南](https://oreil.ly/ZBe39)。

# 贡献 Falco 意味着什么？

Falco 是一个[Cloud Native Computing Foundation](https://www.cncf.io)项目。CNCF 是云原生软件的供应商中立场所。它支持其托管项目的自治模型，并帮助维持健康的开源社区。Falco 主要由社区驱动，包括用户、维护者和开发者，通过以下方式不断策划和改进：

+   提供反馈以改进设计和现有功能

+   测试 Falco 以发现问题

+   报告漏洞

+   撰写项目文档

+   尝试新的创意

+   测试新功能

+   提议变更

+   编写代码

列举不胜枚举。总之，贡献意味着分享知识，为了 Falco 项目的利益进行合作。

# 我应该从哪里开始？

你应该首先加入 Falco 社区。你可以通过加入[Falco Slack 频道](https://oreil.ly/00Az6)并进行自我介绍来做到这一点。社区非常欢迎你的加入。我们建议你订阅[官方邮件列表](https://oreil.ly/R5CSB)。社区成员，包括维护者，还会定期举行周会议，每个人都可以参加。你可以在[社区 GitHub 存储库](https://oreil.ly/VMhp4)中找到关于周会议和其他活动的详细信息。

友情提醒，社区是由人类组成的：善待他们，他们也会善待你。参与社区的每个人都必须遵守其[行为准则](https://oreil.ly/GgbyC)，所以请确保你已阅读并理解它。

# 贡献给 Falcosecurity 项目

正如你现在所知，Falco 及其所有相关项目都托管在[GitHub 上的 Falco 安全组织](https://oreil.ly/KNTDD)下。每个项目都有自己的公共存储库 —— 你甚至可以找到一个包含 [Falco 网站源代码](https://oreil.ly/47j3K)的存储库。如果你还没有 GitHub 账户，你需要[创建一个](https://oreil.ly/F61GW)。我们还建议你花些时间熟悉 GitHub 的工作方式。如果你打算贡献代码，你需要对 Git 有一定的了解。

Falcosecurity 组织有一个自动化的支持机制（或机器人）来帮助你并简化贡献过程。你可能需要一点时间来熟悉它。如果需要帮助，请随时询问！社区的真实人员将乐意帮助你。

在准备任何贡献之前，请务必查阅[在线贡献指南](https://oreil.ly/yRema)，因为这些指南会不时更新。不过，请继续阅读，我们将解释最重要的方面。

## 问题

[GitHub 问题](https://oreil.ly/cOTct)是与项目互动的主要方式。打开一个问题报告错误或提出改进建议是主要的贡献形式之一。正确使用问题对于项目非常重要，因为大多数反馈都来自它们。

每个 Falcosecurity 仓库定义了*问题*的类型。最常见的类型包括*错误报告*、*文档请求*、*测试失败*和*功能请求*。在打开问题时选择类型。根据选择的类型，你会看到一个问题描述以及一个要填写的表单。通常表单包括问题，例如可能会要求你描述一个错误，如何重现它，出现错误的 Falco 版本等等。这些信息帮助他人理解你的问题并进行处理，因此回答所有问题非常重要，这样可以节省时间并增加成功解决问题的机会。

一旦问题被打开，协作过程就开始了。任何对该主题感兴趣的社区成员都可以参与，不仅限于维护者。参与这个过程是一个很好的方式来参与。

这个过程的初始阶段称为*分类*。它涉及验证和分类问题报告中的信息。例如，在错误的情况下，社区成员会尝试重现它，并检查是否如描述的那样出现。在某些情况下，过程会以正确回答问题或简单指向解决问题的资源而结束。在其他情况下，有人自愿实施请求的功能或修复错误，并负责提交*拉取请求*（见下一节）。

你可以在任何阶段参与这个过程。只要是建设性的，每个人都可以做出贡献。

## Pull Requests

[拉取请求（PRs）](https://oreil.ly/bcerI)是将更改提交到 Falcosecurity 项目的唯一途径。当你想要提交新功能或修复时，你需要[分叉相关的仓库](https://oreil.ly/yfuIq)，在你的分支中创建分支，并添加你的提交。一旦你确信你的更改按预期工作，你就可以提交 PR。与问题类似，PRs 使用预定义的[模板](https://oreil.ly/zqqJL)填写。务必仔细阅读说明。模板还包括一些命令，帮助你与自动化进行交互。

提交 PR 后，你需要等待维护者进行审查。维护者有许多正在处理的问题和 PR，所以如果他们没有迅速回复，请耐心等待！他们可能会直接批准 PR 或要求你修改代码。审查过程是协作的：维护者和 PR 作者（有时还有其他用户）分享反馈和评论，直到 PR 被批准和合并。任何时候如果你有疑问，请寻求支持：维护者会解释如何继续。

制作 PR 时需要遵循一些通用指南：

+   每个仓库可能有自己的编码风格和指南；确保你已阅读并理解它们。

+   避免在单个 PR 中提交过多的代码更改；通常提交几个较小且独立的 PR 效果更好。

+   维护者强烈推荐在你的 Git 提交消息中使用[约定式提交风格](https://oreil.ly/BB160)。

+   你必须在所有 Git 提交上签名，并且你的 PR 不得包含合并提交（稍后我们将讨论此问题）。

下面的小节解释了在使用 Git 准备代码时必须满足的主要要求。

### Git 冲突解决和线性历史

有时候在处理 PR 时，你可能需要与上游（远程）分支进行同步。如果远程分支与本地分支有分歧，可能会出现冲突。Git 允许你通过*合并*或*变基*来同步和解决冲突。这两种方法解决同样的问题，但会产生不同的结果。

当本地和远程分支历史不一致时会发生合并，你可以使用`git merge`命令或`git pull`命令来调和非线性历史。然而，合并的缺点是不能保持仓库历史的清洁，这会使得像`git bisect`或`git log`等命令更难使用。因此，Falcosecurity 组织不允许在其项目中进行合并。

相反，*变基* 将你的提交移动到其他分支历史的顶部（而不是引入合并提交）。这确保了 Git 历史始终保持线性。在开发你的 PR 时，你必须始终使用变基来与上游同步或解决与主分支的冲突。下面的命令适用于这两种情况（将 `*<branch>*` 替换为远程分支的名称）：

```
$ git fetch origin
$ git rebase -i origin/*<branch>*
```

如果你不小心引入了合并提交，这个命令还会移除它们。当你只需从远程分支拉取变更时（例如与同一分支上的协作者合作时），可以使用其简短版本`git pull --rebase`。

重申一下：Falcosecurity 组织执行线性历史，并且不允许任何项目使用合并提交。如果你的 PR 包含合并提交，自动化系统会阻止 PR，并且维护者将无法合并它，直到你修复问题。始终使用变基，否则你的更改将无法被接受。

### 开发者证书的起源

2004 年，Linux 基金会（CNCF 的母组织）推出了[开发者签署证书（DCO）](https://oreil.ly/Qttlz)，这是一种轻量级的方式，让贡献者声明他们已经编写（或有权提交）一段代码。要求遵守 DCO 的项目需要贡献者在提交时签署，表示他们同意 DCO 的条款。Git CLI 提供了嵌入的签署功能，您可以通过[`-s`选项](https://oreil.ly/5VcWl)使用，或者手动在提交消息中添加以下行：

```
Signed-off-by: *Full Name <example@example.net>*
```

行必须遵循这种格式，并包含您的姓名和电子邮件地址。

作为 CNCF 的一部分，Falco 及其所有相关项目都需要 DCO。Falco­se⁠curity 组织实施了一个自动化机制来检查 PR 中的 DCO。如果提交中缺少 DCO，自动化将阻止该 PR。因此，请不要忘记在每个提交上签署；否则，维护者无法接受您的贡献。

如果您提交了一个 PR，并且 DCO 检查失败，因为您未在一个或多个提交上签署，不用担心。您可以进行调整。如果您只需修改最后一次提交，请使用：

```
$ git commit --amend --signoff
$ git push --force-with-lease
```

如果您需要修复 PR 中的所有提交，请使用：

```
$ git rebase --signoff origin
$ git push --force-with-lease
```

# 结论

恭喜！您已经完成了本书的阅读！这是一个涵盖架构、语法、实际应用、定制、代码开发以及许多其他有趣主题的漫长旅程。我们真诚希望您喜欢阅读本书，并且更重要的是，书中的内容对您有价值，无论您是初学者还是高级用户。

对我们来说，这是个苦乐参半的时刻。虽然我们很难过地告别，但我们很感激能有机会与您共同经历这段旅程，并且我们为能够帮助使您的软件更加安全感到自豪。

您现在已经准备好开始另一场不可思议的冒险了。作为 Falco 的维护者，我们欢迎您加入项目，并希望能在社区论坛的其中一个见到您。
