# 前言

Kubernetes 默认情况下并不安全。现有的企业和云安全方法受到 Kubernetes 动态特性的挑战，以及使用它通常带来的增强组织敏捷性的目标。成功地在这种新环境中保护、观察和排错关键微服务需要全面理解一系列考虑因素。这些包括组织挑战、新的云原生方法如何帮助应对这些挑战，以及新的最佳实践以及如何操作化它们。

尽管有大量关于 Kubernetes 的资源，但在其中导航并制定全面的安全和可观察性策略可能是一项艰巨的任务，在许多情况下，会导致显著损害所需的安全姿态。

为了指导您朝向一个综合的安全和可观察性策略，覆盖这些考虑的广度，并为您提供在将应用程序迁移到 Kubernetes 时帮助您的最佳实践和工具，我们撰写了这本书。

在我们在 Tigera 工作并构建 Kubernetes 的网络和安全工具 Calico 多年后，我们近距离地见证了用户的旅程。我们看到许多用户专注于在 Kubernetes 中部署工作负载，而没有深思熟虑他们的安全或可观察性策略，然后在尝试理解如何保护和观察这样一个复杂的分布式系统时遇到困难。我们撰写本书的目标是通过与您分享我们所学到的知识，尽量减少这种痛苦。我们在全书中提到了一些工具示例，其中包括 Calico。我们认为 Calico 是一个优秀且受欢迎的选项，但还有许多好的工具，如 Weave Net、VMware Tanzu、Aqua Security 和 Datadog，供您选择。最终，只有您可以决定哪个对您的需求最合适。

# Kubernetes 采用的阶段

任何成功的 Kubernetes 采用过程都遵循三个明确阶段：

学习阶段

作为新用户，您首先要学习 Kubernetes 的工作原理，设置一个沙盒环境，并开始考虑如何在您的环境中使用 Kubernetes。在这个阶段，您希望利用在线 Kubernetes 资源，并使用开源技术。

试点/预生产阶段

一旦你熟悉了 Kubernetes 并理解了它的工作原理，你会开始考虑采用 Kubernetes 的高级战略。在这个阶段，通常会进行试点项目来设置你的集群并引入几个应用程序。随着你在这个阶段的进展，你将会对你将使用的平台有所了解，并且决定它们是在本地还是在云上。如果你选择云端，你将决定是自己托管集群还是利用云提供商提供的托管 Kubernetes 服务。你还需要考虑保护应用程序的策略。此时，你会意识到 Kubernetes 由于其声明性质而与众不同。这意味着平台对于网络、基础设施、主机等方面抽象了很多细节，因此使得你非常容易为你的应用程序使用该平台。由于这一点，你现在需要考虑与 Kubernetes 本地安全相关的安全性，因为你目前使用的保护应用程序、基础设施和网络的方法根本行不通。

生产阶段

到此时，你已经完成了试点项目并成功引入了几个应用程序。你的重点是在生产中运行关键任务应用程序，并考虑是否将大多数应用程序迁移到 Kubernetes 上。在这个阶段，你需要详细计划安全性、合规性、故障排除和可观察性，以便安全有效地将应用程序迁移到生产环境，并实现 Kubernetes 平台的所有好处。

###### 注意

Kubernetes 作为基于容器的应用程序平台的流行和成功使得许多人急于采用它。在过去几年中，托管 Kubernetes 服务提供商已经努力创新并使采用更加容易。新用户可能会被诱惑直接跳过学习和试点阶段，以便快速进入生产阶段。我们警告不要因此而忽视尽职调查。在将关键任务应用程序引入 Kubernetes 之前，你必须将安全性和可观察性视为关键的第一步；否则你的 Kubernetes 采用将是不完整的，并且可能存在安全隐患。

# 这本书适合谁

这本书适合广泛范围的 Kubernetes 实践者，他们处于采用试点/预生产阶段。你可能是平台工程师，或者是安全或 DevOps 团队的一部分。你们中的一些人是组织中首批采用 Kubernetes 的人，希望从一开始就正确处理安全性和可观察性问题。其他人正在帮助在已经采用 Kubernetes 但尚未解决其带来的安全性和可观察性挑战的组织中建立最佳实践。我们假设你具备 Kubernetes 的基础知识——知道它是什么以及如何将其作为托管应用程序的编排工具使用。我们还假设你了解应用程序在 Kubernetes 集群中的部署方式及其分布式特性。

在这个广泛的受众中，有许多不同的角色。以下是一些帮助设计和实施基于 Kubernetes 架构的团队的非详尽列表，这些团队将在本书中找到价值。请注意，您的组织中可能使用不同的角色名称，因此请查看每个角色的职责，以确定在您的组织中对应的角色。本书将使用这些名称帮助您理解一个概念如何影响每个角色。

## 平台团队

平台工程团队负责设计和实施 Kubernetes 平台。许多企业选择实施容器即服务平台（CaaS）策略。这是一个跨企业使用的平台，用于实现基于容器的工作负载。平台工程团队负责平台组件，并将它们提供为应用团队的服务。本书将帮助您了解安全平台的重要性，并提供帮助保护平台层的最佳实践，以便为应用团队提供在安全 Kubernetes 平台上部署应用程序的方法。它还将帮助您了解如何管理新应用程序对平台的安全风险。

## 网络团队

网络团队负责在企业网络中集成 Kubernetes 集群。我们看到这些团队在本地部署 Kubernetes 和在云环境中使用自托管或托管 Kubernetes 服务时扮演不同角色。您将了解网络安全的重要性以及如何建立具有强大安全架构的网络。本书涵盖了将应用程序暴露到 Kubernetes 平台外部以及应用程序访问外部网络的最佳实践。您还将学习如何与其他团队合作，实施保护 Kubernetes 内工作负载外元素的网络安全措施。

## 安全团队

企业安全团队在向云原生应用转型过程中受到的影响最大。云原生应用是专为云环境设计的应用程序，与传统应用程序有所不同。例如，这些应用程序分布在网络基础设施中。本书将帮助您了解如何保护用于托管应用程序的 Kubernetes 平台的详细信息。它将为您提供一个完整的视角，教您如何保护关键工作负载。您将学习如何与各种团队合作，在 Kubernetes 新世界中有效实施安全措施。

## 合规团队

企业的合规团队负责确保组织中的运营和流程符合组织采用的合规标准的要求。您将了解如何在基于 Kubernetes 的平台中实施各种合规要求以及如何监控持续的合规性。请注意，我们不会详细介绍各种合规要求和标准，但我们将为您提供策略、示例和工具，以帮助您满足合规性要求。

## 运营团队

运营团队是负责构建和维护应用程序的开发人员/工具/运维工程师团队。他们也被称为 DevOps 或站点可靠性工程师（SREs）。他们确保应用程序被接入并符合所需的服务水平协议（SLAs）。在本书中，您将了解如何在安全 Kubernetes 集群中扮演角色以及与安全团队的合作。我们将介绍"左移安全"的概念，即安全需要在应用程序开发生命周期的早期阶段发生。在 Kubernetes 平台中，可观察性意味着通过查看平台数据推断有关集群操作的详细信息的能力。这是监视分布式应用程序的现代方式，您将学习如何实施可观察性及其对安全性的重要性。

# 您将学到什么

在本书中，您将学习如何在实施 Kubernetes 战略时考虑安全性，从构建应用程序到构建基础设施再到托管应用程序再到部署应用程序再到运行应用程序。我们将为每个步骤提供安全最佳实践，并附有示例和工具，帮助您保护您的 Kubernetes 平台。我们将介绍如何实施审计、合规性以及像加密这样的其他企业安全控制。

您还将学习如何使用工具和示例来实施可观察性，并展示其与安全性和故障排除的相关性。这种对您的 Kubernetes 平台增强的可见性将驱动与您独特情况相关的可操作见解。

在本书的结尾，您将能够为您的 Kubernetes 集群实施这些安全和可观察性最佳实践。

# 本书中使用的约定

本书中使用以下排版约定：

*Italic*

表示新术语、网址、电子邮件地址、文件名和文件扩展名。

`Constant width`

用于程序清单，以及在段落中引用程序元素，如变量或函数名、数据库、数据类型、环境变量、语句和关键字。

**`Constant width bold`**

显示用户应按照字面意思键入的命令或其他文本。

*`Constant width italic`*

显示应由用户提供的值或由上下文确定的值替换的文本。

###### 注意

此元素表示一般注释。

# 使用代码示例

补充材料（代码示例、练习等）可在 [*https://github.com/tigera/k8s-security-observability-book*](https://github.com/tigera/k8s-security-observability-book) 下载。

如果您有技术问题或在使用代码示例时遇到问题，请发送电子邮件至：*bookquestions@oreilly.com*。

这本书旨在帮助您完成工作。一般情况下，如果本书提供了示例代码，您可以在程序和文档中使用它。除非您复制了本书的大部分代码，否则无需征得我们的许可。例如，编写一个使用本书多个代码片段的程序不需要许可。销售或分发 O’Reilly 书籍中的示例代码需要许可。引用本书回答问题并引用示例代码不需要许可。将本书中大量示例代码整合到产品文档中需要许可。

我们感谢您的支持，但通常不需要署名。署名通常包括标题、作者、出版社和 ISBN 号。例如：“*Kubernetes Security and Observability* 由 Brendan Creane 和 Amit Gupta（O’Reilly）编写。版权所有 2022 年 O’Reilly Media，978-1-098-10711-6。”

如果您觉得使用代码示例超出了合理使用范围或上述许可，欢迎随时与我们联系：*permissions@oreilly.com*。

# O’Reilly Online Learning

###### 注意

40 多年来，[*O’Reilly Media*](http://oreilly.com) 一直为公司提供技术和商业培训、知识和见解，帮助它们取得成功。

我们独特的专家和创新者网络通过书籍、文章以及我们的在线学习平台分享他们的知识和专长。O’Reilly 的在线学习平台为您提供按需访问的现场培训课程、深入学习路径、交互式编码环境，以及来自 O’Reilly 和其他 200 多家出版商的广泛的文本和视频内容。获取更多信息，请访问：[*http://oreilly.com*](http://oreilly.com)。

# 如何联系我们

请将有关本书的评论和问题寄给出版社：

+   O’Reilly Media, Inc.

+   1005 Gravenstein Highway North

+   CA 95472 Sebastopol

+   800-998-9938（美国或加拿大）

+   707-829-0515（国际或本地）

+   707-829-0104（传真）

我们为这本书制作了一个网页，上面列出了勘误、示例和任何额外信息。您可以访问这个页面：[*https://oreil.ly/KSO*](https://oreil.ly/KSO)。

电子邮件 *bookquestions@oreilly.com* 以评论或询问有关此书的技术问题。

获取关于我们的书籍和课程的新闻和信息，请访问：[*http://oreilly.com*](http://oreilly.com)。

在 Facebook 上找到我们：[*http://facebook.com/oreilly*](http://facebook.com/oreilly)

关注我们的 Twitter：[*http://twitter.com/oreillymedia*](http://twitter.com/oreillymedia)

在 YouTube 关注我们：[*http://youtube.com/oreillymedia*](http://youtube.com/oreillymedia)

# 致谢

写作本书是一次很棒的经历，没有几位人士的帮助、支持和指导是不可能的。首先，我们要感谢 Project Calico 的社区、开发人员和维护者，是你们的创新和对 Kubernetes 及其安全性和可观测性的贡献，使我们能够写出这本书。Tigera 令人惊叹的工程和安全研究团队已构建出产品来解决安全和可观测性的复杂挑战，这使我们能够清晰地理解用户面临的挑战。在我们撰写本书的过程中，这些都非常有帮助，以引导用户找到全面的安全和可观测性解决方案。

我们还要感谢那些提供意见和专业知识的审阅者。他们的评论和指导极大丰富了本书内容。特别感谢 Manish Sampat、Alex Pollitt、Virginia Wilson、Seth Vargo、Tim Mackey、Ian Lewis、Puja Absassi 和 Jose Ruiz——你们太棒了！

最后，我们要感谢所有为 Kubernetes 安全性和可观测性做出贡献的社区成员。看到这个领域的创新令人惊叹，我们很高兴能参与到 Kubernetes 安全性和可观测性中去。
