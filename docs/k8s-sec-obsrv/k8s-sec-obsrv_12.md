# 第十二章：结论

我们希望这本书能帮助您了解 Kubernetes 部署的可观察性和安全性与传统部署的不同之处。我们希望这本书能够成为您设计和实施安全性和可观察性策略的指南，无论您是在旅程的早期阶段还是在采用 Kubernetes 的更进一步阶段。关键的观点是，在旅程的每个阶段都需要考虑安全性和可观察性；这不应该是您设计部署后才实施的事后想法。我们经常听到有人说：“我暂时不需要担心安全性或可观察性；让我先让我的工作负载在 Kubernetes 中运行起来。” 这种思维方式是不正确的，因为正确的安全实施可能会改变设计，并可能导致设计的不时迭代和实施的延迟。以下是 Kubernetes 不同的一些特征：

+   Kubernetes 是部署现代应用程序的最广泛采用的编排引擎，被用于公有云和本地部署。

+   Kubernetes 是声明性的，并使用户能够为他们的应用程序部署指定结果（例如，规模、规格、访问等）的性质。

+   Kubernetes 不断监视部署的状态，并采取纠正措施，以确保部署按照指定的方式运行。

+   Kubernetes 抽象了网络、IP 地址等细节，而允许用户使用高级构造（如标签）来定义身份。

+   由于这些特性，为 Kubernetes 实施可观察性和安全性需要采用不同的方法。

Kubernetes 的这些特性也改变了开发过程和涉及的团队。以前，开发团队构建的应用程序将部署在预配基础设施上。在今天的世界中，当您在云中部署应用程序时，您首先会为应用程序需要的基础设施（如主机、虚拟机等）预配基础设施，然后将应用程序部署在预配的基础设施上。此外，基础设施是动态的，并根据应用程序的需求进行调整。以下列出了在 Kubernetes 集群中应用程序的生命周期以及各个团队的角色：

+   应用程序的部署包括构建阶段（创建应用程序所需的资源）、部署阶段（使用 Kubernetes 部署应用程序）和运行时阶段（部署后的应用程序运行）。

+   负责应用程序成功部署和运行的团队包括运维团队、平台团队、网络团队、安全团队和合规团队。

+   要为您的应用设计一个有效的安全性和可观察性策略，您需要在所有阶段考虑安全性和可观察性。

+   团队之间的合作对于成功至关重要，因为安全是所有涉及团队的共同责任。

下面的检查清单是确保你在 Kubernetes 部署中实现有效安全性和可观察性的良好指南：

+   所有镜像在部署前都会进行已知漏洞的扫描，然后定期扫描已部署后发现的漏洞。

+   所有部署的容器镜像都使用最小化的基础操作系统组件构建（例如 distroless 或 scratch 镜像）。

+   主机操作系统采用不可变的 Linux 发行版，减少攻击面。

+   主机操作系统和部署的 Pod 都配置了控制，只允许必要的访问（例如系统调用、文件系统访问）。

+   Kubernetes 集群部署采用密钥加密，确保 API 服务器和数据存储的安全访问。

+   Kubernetes 集群中工作负载的部署受到 RBAC 和准入控制器的最佳实践控制，以强制执行策略。

+   所有服务的访问都遵循安全最佳实践，暴露给外部客户端。

+   Kubernetes 集群与周界安全设备（防火墙或网关）集成，使设备能够查看源自集群的流量，并添加有效的控制。

+   你需要确保网络流量和应用程序流量的访问控制已经就位，使用 L3/L7 策略。

+   确保你使用 Kubernetes 原生工具实现可观察性；例如，你的工具需要意识到支持服务或部署的 Pod 是相同的，并应作为一个单元来“观察”一个服务。

+   确保你实施机器学习来基线集群中各种实体的行为，并在此基础上构建异常检测系统，用于检测安全事件。

+   确保在集群中实施威胁防御功能，如 IDS、IPS 和高级威胁检测技术，以便检测集群内的恶意活动。

+   确保你已经实现了数据传输加密，包括集群内部和与外部实体的通信。

祝愿你在 Kubernetes 之旅中实施工作负载的安全性和可观察性取得最好的结果！
