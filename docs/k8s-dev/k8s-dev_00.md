# 前置内容

## 前言

在 2016 年的圣诞节假期，我坐下来学习 Kubernetes。我很快就要加入 Google Kubernetes Engine (GKE) 团队，需要快速了解这个平台的工作原理。我之前使用过几个平台即服务 (PaaS) 环境，以可扩展的方式部署无状态应用程序，我对 Kubernetes 提供的机会感到兴奋：能够运行任何可以打包进容器的灵活性，以及从无状态到有状态应用程序和批处理作业的各种工作负载结构的通用性。像许多人一样，我发现入门时有一点点学习曲线。

到 2017 年初，我已经积累了一些知识，现在我是 GKE 团队的产品经理，经常与开发者互动。其中一位开发者是我的兄弟，他正在将他的初创公司从 PaaS 迁移到 Kubernetes。我能够分享我所学到的一切，并希望帮助他避免我犯的一些新手错误。但我希望有一种更简单的方式来传递这些知识：专门为那些希望部署到生产级系统而不需要一开始就学习整个系统的应用开发者编写的内 容。

这本书本质上是我希望那些时刻拥有的书。我不假设读者对 Kubernetes 或甚至容器有任何先前的知识。本书通过引导你开发并部署一个简单的容器化应用程序，从在线启动和运行开始，然后逐渐添加额外的 Kubernetes 概念，如有状态应用程序和后台任务队列，来构建你的知识体系。

我的希望是给你信心，让你能够将你的应用程序部署到 Kubernetes 上，同时挑战“Kubernetes 很难”的观念。它确实是一个庞大而复杂的系统，但正如我希望说服你的那样，它的广泛范围为你提供了许多强大的功能，当你有复杂的工作负载要部署时，这些功能将非常有用。但那可以稍后再说。你不需要一次性学习所有内容！事实上，部署无状态应用程序相当简单，所以从那里开始，在你需要的时候再添加其他内容。

到本书结束时，你可能会欣赏这个平台的灵活性，当你有那些在更多专用平台（如许多 PaaS 环境）上难以满足的要求时，我相信你会这样。

写技术书让我有些紧张，尤其是考虑到这需要多年的时间，我担心技术会变化太多，部分内容会过时，我不得不不断重写以跟上进度。幸运的是，我可以报告说，关于我所写的每一个普遍可用（GA）的概念，特别是具有 v1 版本的 Kubernetes API，内容都保持最新。这次经历让我对 Kubernetes 在您自己的项目中使用的稳定性以及这本书的持久性都充满了希望。在我撰写内容时，我涵盖了一些非 GA API，它们确实发生了很大的变化。幸运的是，在我完成写作时，所有内容都已达到 GA，我能够更新内容以使用这些稳定的版本（基于这一点，我也会尽量避免使用 beta API，除非是为了实验）。

当我加入 GKE 团队时，Kubernetes 正在迅速获得人气，但尚未无处不在。我记得我对能够参与看起来是开源软件的关键部分感到兴奋，但同时也有一些不确定性，不知道事情会如何发展（因此，有机会以积极的方式产生影响）。好吧，在那段时间里，我们基本上看到每个云平台都提供了自己的托管平台（幸运的是，它们之间具有高度的兼容性，并且有一种维护软件兼容性的文化），Kubernetes 也成为了人们在生产中编排容器的首选方式。我很享受作为 Kubernetes 社区的一员，并参与这样一个关键的计算平台。我希望这本书能帮助你在自己的 Kubernetes 之旅中取得成功！

## 致谢

首先，我想感谢我的开发编辑 Elesha Hyde，他教会了我如何将技术内容编织成故事，并对最终产品产生了重大影响。我要感谢我的技术发展编辑 Shawn Smith，感谢您对早期草稿的详细审查和您的建议，这有助于完善叙事。感谢 Michael Stephens，四年前当我向您推销这本书时，您对我写作的信心。还要感谢 Manning 出版社的每一个人，是你们帮助这本书成为现在的样子：Deirdre Hiam，我的项目编辑；Alisa Larson，我的校对编辑；以及 Mike Beady，我的校对员。在开始这个项目之前，我并不知道与你们所有人合作会对书籍的质量产生多大的贡献，但很快这一点就变得明显了。

向所有审稿人致谢：阿马尔·马尼甘丹、安德烈斯·萨科、阿里埃尔·加米诺、阿图尔·S·科特、贝基·胡特、邦妮·马莱克、查斯·西利维斯、克里斯·亨尼根、克里斯·维纳、康纳·雷德蒙德、大卫·帕库德、达维德·菲奥伦蒂诺、迪皮卡、乔治·托马斯、朱利奥·拉蒂尼、格雷戈里奥·皮科利、盖·恩杰恩、汉斯·多纳、哈里纳特·马莱帕利、伊奥安尼斯·波利佐斯、贾维德·阿萨罗夫、胡安·吉梅内斯、朱利恩·波希、卡梅什·加内桑、卡蒂凯亚拉贾恩·拉贾恩、凯卢姆·普拉巴瑟·塞纳纳亚克、凯文·约翰逊、科斯马斯·查齐米查利斯、克日什托夫·卡米切克、马克·德尚普斯、迈克尔·布莱特、迈克·赖特、米切尔·福克斯、纳吉布·阿里夫、皮埃尔-米歇尔·安塞尔、拉胡尔·莫杜普、拉贾谢兰·加内斯瓦兰、拉姆巴布·波萨、理查德·沃恩、罗伯特·基尔蒂、萨塔杜鲁·罗伊、塞巴斯蒂安·捷克、塞尔吉乌·波帕、西梅翁·莱泽宗、苏哈斯·克里什纳亚亚、巴希鲁丁·艾哈迈德、文卡特什·桑达拉莫里、瓦尔德马尔·莫德泽列夫斯基、扎兰·索莫盖瓦里，你们的建议帮助使这本书变得更好。

我非常感谢曼宁的技术团队，他们构建了强大的工具，为曼宁早期访问计划（MEAP）提供动力，这意味着我可以在内容仍在进行中时分享内容，并直接从我的早期读者那里获得反馈。还要感谢在书还只完成了一半时通过 MEAP 购买这本书的每个人。

感谢我的工作团队：德鲁·布拉德斯托克和约查伊·基里亚蒂，他们相信我并支持我全身心投入这个 120%的项目，以及你们创造的团队环境，让做事情变得有趣。感谢蒂姆·霍金、陈·戈德堡、凯尔西·海托沃、埃里克·布赖尔、杰里米·奥尔斯泰德-汤普森、杰齐·福里西亚尔茨、布莱恩·格兰特，他们对我影响深远，以及阿帕尔娜·辛哈，她早期就对我下了赌注。

托姆·爱德华兹是一位摄影师和站点可靠性工程师，他在一次 KubeCon 期间为我拍摄了个人照片；请查看他的作品在[tomedwardsphotography.com](https://tomedwardsphotography.com/)。谢谢，兄弟！

最后，感谢我的家人支持我完成这个项目。阿伦和艾希莉，尽管你们太小，不知道我在做什么，但每天我们一起走到 Imua，我可以在你们附近玩耍的同时，安静地工作在稿件上，这些时刻我将永远珍视。感谢我的妻子，菲奥娜，感谢你支持我所有的努力，在我需要的时候给我现实感。感谢先琼，感谢你支持我们的家庭——没有你的帮助，我几乎没时间做任何事情。感谢朱莉、格雷厄姆和劳拉，感谢你们从小培养我对技术的兴趣，以及我的兄弟姐妹，杰西卡和彼得，感谢你们始终相互支持，以及我们的各种努力。

## 关于这本书

您是否想在云中托管一个应用程序，在云环境中拥有处理您需求变化的能力，并具有大规模扩展的潜力？本书将为您提供所需的知识，无论应用程序是 Python、Java、Ruby 还是其他任何语言，都可以自信地将它部署到云中，在专业级平台上使用容器和 Kubernetes 满足您现在的需求，并适应未来的发展。

如果您没有准备好的应用程序可以部署，本书提供了一个供您使用的示例应用程序。无需具备 Docker 或 Kubernetes 的先验知识。本书结束时，您应该有信心在生产环境中部署工作负载到 Kubernetes，从无状态应用程序到批处理作业和数据库。

### 适合阅读本书的人群

目前市面上有许多关于 Kubernetes 的书籍，它们针对不同的受众。本书专门为开发者编写，旨在涵盖一段旅程，类似于：“我笔记本电脑上有一堆代码。我如何将其发布到世界，并且在一个如果我的产品成为热门产品就可以扩展的平台上进行发布？”当我学习 Kubernetes 时，我希望有一个端到端的演示，展示如何将我的代码放入 Kubernetes，更新，平稳运行而无需干预，并在需要时准备好扩展。我希望这本书能为您做到这一点。

如果您对容器不熟悉，无需担心，因为本书包含了一章关于应用程序容器化的内容，这样您就可以准备好部署。如果您已经熟悉 Docker 和容器，并希望立即开始部署到 Kubernetes，您可以直接跳到第三章。

### 本书是如何组织的

本书分为两部分。第一部分旨在向您介绍 Kubernetes 的基础知识，从构建容器并在 Kubernetes 中运行它们开始。您将学习如何设置正确的资源并配置它们以充分利用 Kubernetes 的自动化操作，当然，还包括如何更新您的应用程序。如果您目标是部署无状态应用程序到 Kubernetes，这可能就是您所需要的：

+   第一章是 Kubernetes 及其优势的高级概述。

+   第二章是针对应用程序开发者的 Docker 速成课程。如果您已经熟悉，可以自由跳过。

+   第三章将帮助您开始您的第一个 Kubernetes 部署。部署、暴露给互联网，并更新。现在您已经通过 Kubernetes 上线了。

+   第四章增加了对更可靠部署的必要健康检查。

+   第五章帮助您合理调整工作负载，使其获得所需的资源而不会浪费。

第二部分更深入地探讨了 Kubernetes 的生产方面。您将学习关于扩展应用程序、配置内部服务以及部署工作负载结构，如有状态应用程序和后台处理队列。本书通过涵盖配置即代码、持续部署和安全考虑来结束。

+   第六章是关于扩展（和缩减）：手动、自动化、节点和 Pods——这里都有。

+   第七章讨论了如何配置内部服务和微服务架构，并介绍了基于 HTTP 的负载均衡。

+   第八章介绍了如何在您的负载中指示容器的特定硬件要求，以及如何在节点上分组或分散 Pods。

+   第九章帮助您设置有状态的工作负载，如数据库。

+   第十章是关于请求/响应链之外发生的所有活动，包括任务队列和批量作业。

+   第十一章是 GitOps 的介绍，涵盖了如何为不同环境使用命名空间，并将配置视为代码。

+   第十二章以几个值得开发者考虑的安全主题结束本书。

## 关于代码

本书中的代码在 Apache 2.0 许可下是开源的，可以在[`github.com/WilliamDenniss/kubernetes-for-developers`](https://github.com/WilliamDenniss/kubernetes-for-developers)上完整下载。

示例按章节编号组织到文件夹中。Kubernetes 配置可以在以章节或子章节命名的子文件夹中找到，以及一个描述性后缀。例如，出现在第三章第 3.2 节的配置可以在 Chapter03/3.2_DeployingToKubernetes 中找到。示例容器化应用程序在全书构建，可以在相关章节文件夹中找到。例如，它首先出现在第二章，位于 Chapter02/timeserver，并在第四章更新为 Chapter04/timeserver2，等等。

每个代码列表都以文件的完整路径命名，便于参考。示例命令，贯穿全书，从基础文件夹开始，因此您可以按顺序外阅读；只需在开始新部分时将命令行 shell 重置到基础目录，然后就可以继续了。

Mac、Linux 和 Windows 都可以用来运行本书中的示例，设置说明在第二章和第三章中提供。

对于 Google Cloud 用户，可以使用基于浏览器的 Cloud Shell（https://cloud.google.com/shell）来运行本书中的每个示例指令，包括使用 Docker 和 minikube 的示例，无需在本地安装任何东西，除了 Docker Desktop 的本地 Kubernetes 环境（请按照 minikube 的说明操作）。

本书包含许多源代码示例，既有编号列表，也有与普通文本并列的。在两种情况下，源代码都以`固定宽度字体`如这样格式化，以将其与普通文本区分开来。有时代码也会**`加粗`**以突出显示章节中从先前步骤更改的代码，例如当新功能添加到现有代码行时。

在许多情况下，原始源代码已被重新格式化；我们添加了换行符并重新调整了缩进，以适应书籍中的可用页面空间。在极少数情况下，即使这样也不够，列表中还包括了行续接标记（➥）。此外，当代码在文本中描述时，源代码中的注释通常已从列表中删除。许多列表旁边都有代码注释，突出显示重要概念。

您可以从本书的 liveBook（在线）版本中获取可执行的代码片段，网址为 [`livebook.manning.com/book/kubernetes-for-developers`](https://livebook.manning.com/book/kubernetes-for-developers)。书中示例的完整代码可在 Manning 网站 [`www.manning.com/books/kubernetes-for-developers`](https://www.manning.com/books/kubernetes-for-developers) 和 GitHub [`github.com/WilliamDenniss/kubernetes-for-developers`](https://github.com/WilliamDenniss/kubernetes-for-developers) 上下载。

### liveBook 讨论论坛

购买《Kubernetes for Developers》包括免费访问 liveBook，Manning 的在线阅读平台。使用 liveBook 的独家讨论功能，您可以在全球范围内或针对特定章节或段落附加评论。为自己做笔记、提出和回答技术问题，以及从作者和其他用户那里获得帮助都非常简单。要访问论坛，请访问 [`livebook.manning.com/book/kubernetes-for-developers/discussion`](https://livebook.manning.com/book/kubernetes-for-developers/discussion)。您还可以在 [`livebook.manning.com/discussion`](https://livebook.manning.com/discussion) 上了解更多关于 Manning 的论坛和行为准则。

曼宁对读者的承诺是提供一个平台，在这个平台上，读者之间以及读者与作者之间可以进行有意义的对话。这并不是对作者参与特定数量活动的承诺，作者对论坛的贡献仍然是自愿的（且未支付报酬）。我们建议您尝试向作者提出一些挑战性的问题，以免他的兴趣转移！只要书籍在印刷中，论坛和先前讨论的存档将可通过出版社的网站访问。

### 其他在线资源

+   官方 Kubernetes 文档位于 [`kubernetes.io/docs/`](https://kubernetes.io/docs/)

+   容器基础镜像位于 [`hub.docker.com/`](https://hub.docker.com/)

+   StackOverflow 在 [`stackoverflow.com/questions/tagged/kubernetes`](https://stackoverflow.com/questions/tagged/kubernetes)

作者关于 Kubernetes 和 GKE 主题的更多内容可在 [`wdenniss.com/kubernetes`](https://wdenniss.com/kubernetes) 找到。

本书中的图示所使用的资源图标来自 Kubernetes 作者的 Kubernetes 图标集，许可协议为 CC BY 4.0。它们可以在[`github.com/kubernetes/community/`](https://github.com/kubernetes/community/)找到。

Kubernetes 标志由 Kubernetes 作者设计，并许可协议为 CC BY 4.0。它可以在[`github.com/kubernetes/kubernetes/`](https://github.com/kubernetes/kubernetes/)与 Kubernetes 本身的源代码一起下载。

## 关于作者

William Denniss 是谷歌的产品经理，他在谷歌 Kubernetes Engine (GKE) 上工作。他与他人共同创立了 GKE 的 Autopilot 体验，构建了一个完全管理的 Kubernetes 平台，该平台提供完整的 Kubernetes 体验，无需管理底层计算节点。他坚信开放标准和开源软件可以推动行业发展，他在 GKE 团队的第一个项目是与 Kubernetes 社区和云原生计算基金会合作，创建认证 Kubernetes 兼容性计划，以鼓励 Kubernetes 提供商之间的广泛兼容性。

2014 年加入谷歌，他最初在身份空间工作，目标是改善用户在移动设备上与身份系统交互的方式。他编写了目前最佳实践 OAuth for Native Apps，作为 RFC 8252 发布，并共同创立了开源库 AppAuth，用于 iOS、Android 和 JavaScript，以提供该最佳实践的共同实现。

他喜欢通过教学来学习，并花费大量业余时间编码和迭代各种项目。如果他有设备，他很可能正在为它编写代码，无论是高中时的图形计算器，运行 Windows、Linux 或 Mac 的计算机（在各个时期），2000 年代的 PlayStation Portable，还是自 iPhone 3G 以来使用的 iPhone。最终，项目需要服务器组件，这首先让他十年前开始在平台即服务（PaaS）上部署代码，并激发了他后来在有机会时从事 Kubernetes 的工作的兴趣，以帮助使具有类似要求的开发者生活更加轻松。

他的产品管理超级能力是成为他构建的产品热情的用户。

## 关于封面插图

《Kubernetes for Developers》封面上的图像是由 Dominic Serres 创作的插图，标题为“一位与战舰船员一起的船员”，创作于 1777 年。这幅艺术品属于描绘英国皇家海军制服的图像系列，从本插图中的水手到中尉等级，再到海军上将。插图中的水手穿着一件短蓝色夹克，配有布覆盖的按钮， scalloped 海员袖口，三粒扣闭合，以及一件朴素的白色背心。他还穿着从腰部延伸到小腿顶部的裙子裤子，朴素的白色长袜，以及带有白色金属搭扣的鞋子。

在难以区分一本计算机书籍与另一本的时候，Manning 通过基于历史人物和过去服饰的丰富多样性设计的书封面，庆祝了计算机行业的创新精神和主动性，就像这样的插图一样，将它们重新带回生活。
