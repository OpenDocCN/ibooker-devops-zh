# 前置内容

## 前言

我第一次尝试用微服务构建应用程序是在 2013 年左右。那一年 Docker 最初发布，但当时我还没有听说过它。当时，我们为每个微服务运行一个单独的虚拟机来构建一个应用程序。正如你所预期的，这是一种运行微服务的非常昂贵的方式。

由于运行成本高昂，我们当时选择了创建较少的微服务，而不是更多的微服务，将越来越多的功能推入现有的微服务中，以至于我们真的无法再称之为微服务了。当然，它仍然是一个分布式应用程序，只是没有我们期望的那么“微型”。

到那时，我已经知道微服务是一个强大的想法，如果它们更便宜的话。我把微服务放回架子上，但记下我应该稍后再看看它们。

在接下来的几年里，我作为旁观者看着围绕微服务的工具和技术的发展，得益于开源编码的兴起（以及其持续的增长）。我还看着云计算的成本持续下降，这是由供应商之间的竞争推动的。随着时间的推移，很明显，使用微型组件构建和运行分布式应用程序正变得更加经济高效。

经过似乎是一生的时间，到 2018 年初，我正式回到了微服务的世界。我有两个机会，我认为微服务是合适的。两个都是初创公司。第一个是为一家有前途的年轻公司启动一个新微服务应用程序的合同工作。第二个是为我的初创公司构建一个微服务应用程序。

为了成功，我知道我需要新的工具。我需要一个有效的方式来打包微服务。我需要一个可以部署微服务的计算平台。关键的是，我需要能够自动化部署。

到那时，Docker 已经在我们的行业中占据了很大的份额，所以我知道它作为打包微服务的方式是一个安全的赌注。我也喜欢 Kubernetes 作为微服务的计算平台的外观，但一开始我对它非常不确定。然而，Kubernetes 承诺了一个摆脱云供应商锁定的未来——这非常吸引人。

到这个时候，我已经读过很多关于微服务的书籍。这些书籍都很有趣，在理论上提供了很好的价值。我确实喜欢阅读理论，但这些书籍缺乏实际案例，这些案例本可以帮助我克服自己的学习曲线。即使作为一个经验丰富的开发者，我也在努力寻找起点！我知道从过去的经验中，项目开始时做出的糟糕技术决策会一直困扰我到项目结束。

学习 Kubernetes 特别困难。从外面看，它似乎难以渗透。但我有工作要做，我需要一种交付软件的方式。所以我继续努力。进展艰难，我几次差点放弃 Kubernetes。

当我发现 Terraform 时，情况发生了变化。这对我来说是拼图缺失的一块。它使得 Kubernetes 变得可理解和可用，到了我除了承诺使用它之外别无选择的地步。

Terraform 是让我能够描述我的应用程序结构的工具。然后 Terraform 可以存在于我的持续交付（CD）管道中，并自动保持我的应用程序更新！我开始编写*基础设施即代码*，感觉就像我进入了高级别。

我凭借长期评估技术和快速学习工作的经验，加上一些试验和错误的尝试，强行克服了学习曲线。我的努力交付了性能良好、灵活、可靠、可扩展的软件，并且至今仍在运行。在这段时间里，我写这本书的愿望产生了，并逐渐增长到不得不采取行动的地步。

一个新的使命形成了——我想让微服务更容易获得。我感到有必要写这本书；这是我想要但没有的书。我知道我可以帮助人们，而最好的方式就是通过一本实用的书，这本书。一本书，它会一步一步地展示微服务*并不*难或复杂；这完全取决于你的方法和你的视角。你现在手中就有这个劳动成果。我经历了艰难，这样你就不必了。

## 致谢

在《自举微服务》中，我与你们分享了我多年辛苦积累的经验。没有周围人的支持和鼓励，这样的经验是不可能的。

有许多人帮助我走到了今天。如果没有我的父母 Garry 和 Jan 买给我的第一台电脑，我就不会成为开发者。我的生活伴侣 Antonella，她不懈地支持我完成了两本书。我的商业伙伴 Majella，她倾听我关于技术的所有抱怨，并且仍然推动我前进。谢谢大家！

当然，感谢 Manning 提供的机会，尤其是感谢 Helen Stergius，她再次编辑了我的书。希望这次作为更有经验的作者，我能让你们的工作变得更轻松。还要感谢 Manning 团队全体成员的努力。

感谢技术校对员 Alain Couniot 以及所有在将这本书提升到下一个水平方面发挥了巨大作用的审稿人：Angelo Simone Scotto、Anupam Sengupta、Barnaby Norman、Björn Neuhaus、Bonnie Malec、Chris Kolosiwsky、Chris Viner、Dan Sheikh、Dhruvesh Patel、Donald McLamb、Eric Platon、Ernesto Bossi Carranza、Giampiero Granatella、John Guthrie、Julien Pohie、Marcin Sęk、Michele Adduci、Miguel Montalvo、Rich Ward、Rinor Maloku、Ruben Vandeginste 和 Weyert de Boer。

当然，技术编辑 Jeanne Boyarsky 值得特别的感谢。她做了出色的“吹毛求疵”（正如她所说），而且由于她的参与，这本书变得更好。

最后，我想感谢开发社区。你们的反馈和鼓励使这本书的写作变得愉快。我写这本书是为了你们！

## 关于本书

使用微服务构建应用程序——构建*分布式应用程序*——可能是一个复杂的过程，学习起来可能很困难。如果你陷入了一个现代复杂的应用程序，可能很难从森林中看到树木。除了简单地编码之外，还有更多需要考虑的因素。而且，这并不是一个容易独自承担的旅程。

要使用微服务，你必须了解如何构建分布式应用程序。但仅凭这一点是不够的。你还必须学习开发、测试和部署此类应用程序所需的深入而复杂的工具。我们如何组装一个健壮的开发工具包？我们从哪里开始？

在过程中还有更多问题。我们如何打包和部署微服务？我们如何配置我们的开发环境以进行本地测试？我们如何让我们的微服务相互通信，以及我们如何管理数据？最重要的是，我们如何将微服务部署到生产环境？然后，一旦进入生产环境，我们如何管理、监控和修复可能涉及数百个微服务的问题？

本书，*自举微服务*，回答了这些问题以及更多！它是你使用最新工具构建应用程序的指南。我们将从无到有，一直到一个在生产环境中运行的工作微服务应用程序。

在这本书中，你不会找到很多理论。*自举微服务*是实用且基于项目的。我们将一起研究许多微服务的示例，最终达到生产阶段，涵盖你作为一个自信的微服务开发者所需了解的所有内容。

本书中的每个示例都附带可在 GitHub 上找到的工作代码。你可以亲自尝试并做出自己的实验性更改。

## 应该阅读本书的人

本书面向任何想要了解更多关于微服务实际工作方面的人；那些需要明确指南来组装他们的工具集并将应用程序完整地推向生产的人。本书不教授编码，因此建议具备基本的编码技能。

注意：如果你对现代编程语言（如 C#、Java、Python 或 JavaScript）有一些基本或入门级经验，你应该能够跟随这本书的内容。

代码示例尽可能简单，但本书不仅仅关于代码。它更多地是关于教你如何组装构建微服务应用程序所需的工具包。

如果你没有编程经验，但学习速度快，你可以在阅读*Bootstrapping Microservices*时学习基本的 JavaScript（通过另一本书、教程、视频等）。就像我说的，代码示例尽可能简单，所以你有机会在没有太多编程经验的情况下阅读代码并理解其精髓。我们的编码冒险从第二章开始，在那里你将学习如何使用 JavaScript 和 Node.js 构建一个简单的微服务。

## 本书是如何组织的：一个路线图

在本书的 11 章中，我们从构建单个微服务一直扩展到在准备就绪的 Kubernetes 集群中运行多个微服务。

+   第一章是微服务介绍，并解释了为什么我们要使用这些服务。

+   第二章通过使用 Node.js 和 JavaScript 构建一个简单的微服务来展开。我们学习了如何使用实时重新加载以实现更流畅的开发过程。

+   第三章介绍了 Docker，用于打包和发布我们的微服务，使其准备好部署。

+   第四章扩展到多个微服务，并介绍了 Docker Compose，用于在开发工作站上模拟我们的微服务应用程序。然后我们涵盖了微服务的数据管理，包括拥有数据库和外部文件存储。

+   第五章升级了我们的开发环境，以实现*整个应用程序*的实时重新加载。然后我们涵盖了微服务之间的通信，包括用于直接消息的 HTTP 和用于间接消息的 RabbitMQ。

+   第六章介绍了 Terraform 和 Kubernetes。我们使用 Terraform 在 Microsoft Azure 上创建一个私有容器注册和 Kubernetes 集群。

+   第七章使用 Terraform 将微服务部署到我们的 Kubernetes 集群。我们部署了一个数据库、一个 RabbitMQ 服务器，最后是一个微服务。我们还探讨了如何创建一个持续交付（CD）管道，以自动化将我们的应用程序部署到生产环境。

+   第八章展示了我们可以将多个级别的自动化测试应用到微服务中。

+   第九章概述了示例应用程序，并回顾了在部署示例应用程序时学到的技能。

+   第十章探讨了我们可以构建可靠和容错性微服务的方法，然后监控这些服务以维护应用程序的健康状态。

+   第十一章通过展示将你的微服务应用程序扩展以支持不断增长的业务、组织以管理不断增长的开发团队的实际方法来结束。它还涉及安全性、重构单体以及如何在预算内使用微服务进行构建。

## 关于代码

本书包含许多源代码示例，既有编号列表，也有与普通文本并行的代码。在两种情况下，源代码都使用`固定宽度字体`格式化，以将其与普通文本区分开来。

在许多情况下，原始源代码已经被重新格式化；我们添加了换行并重新调整了缩进，以适应书中的可用页面空间。在极少数情况下，即使这样也不够，列表中还包括了行续接标记（➥）。此外，当代码在文本中描述时，源代码中的注释通常已被从列表中删除。许多列表旁边都有代码注释，突出显示重要概念。

本书示例的代码可以从 Manning 网站[`www.manning.com/books/bootstrapping-microservices-with-docker-kubernetes-and-terraform`](https://www.manning.com/books/bootstrapping-microservices-with-docker-kubernetes-and-terraform)和 GitHub[`github.com/bootstrapping-microservices.`](https://github.com/bootstrapping-microservices)下载。

您可以下载每个章节（第二章到第九章）的 zip 文件，或者您可以使用 Git 克隆每个章节的 Git 代码仓库。每个示例都设计得尽可能简单，自包含且易于运行。随着您在书中的进展，您将以不同的方式运行代码。

我们首先在 Node.js（第二章）下直接运行单个微服务代码，然后在 Docker（第三章）下运行。接着，我们在 Docker Compose（第四章和第五章）下运行多个微服务。

接下来，我们在 Terraform 下运行代码，首先是本地（第六章），然后是在我们的持续交付管道中（第七章）。在第六章和第七章中，我们还将我们的微服务运行在云端的 Kubernetes 集群上。在第八章中，我们回到 Node.js，在 Jest 和 Cypress 下运行自动化测试。最后，在第九章中，我们回顾迄今为止学到的技能（从第二章到第八章）。第九章的示例代码是一个简单但完整的微服务应用程序，您可以在开发和生产环境中运行它。

在代码示例中，我力求遵循标准约定和最佳实践。我要求您通过 GitHub 提供反馈并报告任何问题。

## liveBook 讨论论坛

购买《使用 Docker、Kubernetes 和 Terraform 启动微服务》（*Bootstrapping Microservices with Docker, Kubernetes, and Terraform*）包括免费访问由 Manning Publications 运行的私有网络论坛，您可以在论坛上对本书发表评论、提出技术问题，并从作者和其他用户那里获得帮助。要访问论坛，请访问[`livebook.manning.com/#!/book/bootstrapping-microservices-with-docker-kubernetes-and-terraform/discussion`](https://livebook.manning.com/#!/book/bootstrapping-microservices-with-docker-kubernetes-and-terraform/discussion)。您还可以在[`livebook.manning.com/#!/discussion`](https://livebook.manning.com/#!/discussion)了解更多关于 Manning 的论坛和行为准则。

Manning 对读者的承诺是提供一个场所，让读者之间以及读者与作者之间可以进行有意义的对话。这不是对作者参与特定数量活动的承诺，作者对论坛的贡献仍然是自愿的（且未付费）。我们建议您尝试向作者提出一些挑战性的问题，以免他的兴趣转移！只要这本书有售，论坛和先前讨论的存档将可通过出版社的网站访问。

## 关于作者

Ashley Davis 是一位拥有超过 20 年软件开发经验的软件工匠、企业家和作家，从编码到管理团队，再到创立公司。他为各种公司工作过，从小型初创公司到最大的国际公司。在这个过程中，他通过写作和开源编码回馈了社区。

Ashley 是 Sortal 的首席技术官，Sortal 是一个利用机器学习的魔法自动整理数字资产的产品。他是 Data-Forge Notebook 的创造者，这是一个使用 JavaScript 和 TypeScript 进行探索性编码和数据可视化的笔记本式桌面应用程序。Ashley 还是一位热衷于算法交易的交易员，积极进行交易并开发量化交易软件。

想了解他的书籍更新、开源编码等内容，请关注 Ashley 的推特 [@ashleydavis75](https://twitter.com/ashleydavis75)，在 Facebook 上的“数据整理师”关注他，或访问他的博客 [`www.the-data-wrangler.com`](http://www.the-data-wrangler.com)。

想了解更多关于 Ashley 的背景信息，请访问他的个人网页 ([`www.codecapers.com.au`](http://www.codecapers.com.au)) 或他的领英资料页 ([`www.linkedin.com/in/ashleydavis75`](https://www.linkedin.com/in/ashleydavis75))。

## 关于封面插图

《使用 Docker、Kubernetes 和 Terraform 自举微服务》封面上的插图被标注为“加泰罗尼亚”或西班牙东北部的加泰罗尼亚人。这幅插图取自雅克·格拉塞·德·圣索沃尔（1757-1810）的作品集，名为《Costumes civils actuels de tous les peoples connus》，1788 年在法国出版。每一幅插图都是手工精心绘制和着色的。格拉塞·德·圣索沃尔的丰富藏品生动地提醒我们，200 年前世界的城镇和地区在文化上有多么不同。他们彼此孤立，说着不同的方言和语言。在街道或乡村，仅凭他们的服装就能轻易识别他们居住的地方以及他们的职业或社会地位。

自那以后，我们的着装方式已经改变，而当时区域间的多样性，如此丰富，现在已经逐渐消失。现在很难区分不同大陆的居民，更不用说不同的城镇、地区或国家了。也许我们用文化多样性换取了更加丰富多彩的个人生活——当然，是更加多样化和快节奏的技术生活。

在难以区分一本计算机书与另一本的时候，曼宁通过基于两百年前丰富多样的区域生活所设计的书封面，庆祝了计算机行业的创新精神和主动性，这些画面由格拉塞·德·圣索沃尔重新赋予生命。
