# é™„å½• A. è®¾ç½®æµ‹è¯• Kubernetes é›†ç¾¤

ä¸€ä¸ªå®Œå…¨å…·å¤‡ç”Ÿäº§èƒ½åŠ›çš„ Kubernetes é›†ç¾¤æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç³»ç»Ÿï¼Œç”±å¤šä¸ªç»„ä»¶ç»„æˆï¼Œè¿™äº›ç»„ä»¶å¿…é¡»æ ¹æ®ä½ çš„ç‰¹å®šéœ€æ±‚è¿›è¡Œå®‰è£…å’Œé…ç½®ã€‚å¦‚ä½•åœ¨ç”Ÿäº§ä¸­éƒ¨ç½²å’Œç»´æŠ¤ Kubernetes è¿œè¿œè¶…å‡ºäº†æœ¬ä¹¦çš„ç„¦ç‚¹ï¼Œå¹¶åœ¨å…¶ä»–åœ°æ–¹è¿›è¡Œäº†ä»‹ç»ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæœ‰å‡ ä¸ªé¡¹ç›®å¯ä»¥å¤„ç†é…ç½®å¤æ‚æ€§ï¼Œå¹¶å…è®¸ä½¿ç”¨å•ä¸ª CLI å‘½ä»¤åœ¨æœ¬åœ°è¿è¡Œ Kubernetesã€‚åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šæœ¬åœ°è¿è¡Œ Kubernetes å¯¹äºç†Ÿæ‚‰ Kubernetes å¹¶ä¸ºä½ å®Œæˆæœ¬ä¹¦ä¸­çš„ç»ƒä¹ åšå¥½å‡†å¤‡éå¸¸æœ‰ç”¨ã€‚å°½å¯èƒ½å¤šçš„ç»ƒä¹ éƒ½å°†åˆ©ç”¨åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šè¿è¡Œçš„ minikube é›†ç¾¤ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨è‡ªå·±è¿è¡Œçš„é›†ç¾¤ï¼ˆæ— è®ºæ˜¯åœ¨äº‘æœåŠ¡æä¾›å•†ä¸Šè¿˜æ˜¯åœ¨æœ¬åœ°ï¼‰ï¼Œç»ƒä¹ åŒæ ·å¯ä»¥åœ¨é‚£é‡Œè¿›è¡Œã€‚

minikube Minikube æ˜¯ Kubernetes ç¤¾åŒºç»´æŠ¤çš„å®˜æ–¹å·¥å…·ï¼Œå¯ä»¥åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šçš„è™šæ‹Ÿæœºå†…éƒ¨åˆ›å»ºå•ä¸ªèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ã€‚å®ƒæ”¯æŒ macOSã€Linux å’Œ Windowsã€‚é™¤äº†å®é™…è¿è¡Œé›†ç¾¤å¤–ï¼Œminikube è¿˜æä¾›ç®€åŒ–è®¿é—® Kubernetes å†…éƒ¨æœåŠ¡ã€å·ç®¡ç†ç­‰åŠŸèƒ½ã€‚

ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨çš„å…¶ä»–é¡¹ç›®

+   *Docker for desktop*â€”å¦‚æœä½ åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šä½¿ç”¨ Dockerï¼Œä½ å¯èƒ½å·²ç»å®‰è£…äº† Kubernetesï¼ä»ç‰ˆæœ¬ 18.6.0 å¼€å§‹ï¼ŒWindows å’Œ Docker Desktop for Mac éƒ½è‡ªå¸¦äº†æ†ç»‘çš„ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶å’Œå¼€å‘è€…ç”Ÿäº§åŠ›åŠŸèƒ½ã€‚

+   *K3s*â€”æ­£å¦‚å…¶åæ‰€ç¤ºï¼ŒK3s æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Kubernetes éƒ¨ç½²ã€‚æ ¹æ®å…¶ä½œè€…çš„æè¿°ï¼ŒK3s æ¯”å…«å°‘äº”ï¼Œæ‰€ä»¥ K8s å‡å»äº”å°±æ˜¯ K3sã€‚é™¤äº†æœ‰è¶£çš„åå­—å¤–ï¼ŒK3s ç¡®å®éå¸¸è½»é‡çº§ã€å¿«é€Ÿï¼Œå¦‚æœä½ éœ€è¦å°† Kubernetes ä½œä¸º CI ä½œä¸šçš„ä¸€éƒ¨åˆ†æˆ–åœ¨èµ„æºæœ‰é™çš„ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å®‰è£…è¯´æ˜å¯åœ¨[`k3s.io.`](https://k3s.io/)æ‰¾åˆ°ã€‚

+   *Kind*â€”å¦ä¸€ä¸ªç”± Kubernetes ç¤¾åŒºå¼€å‘çš„å·¥å…·ï¼Œkind æ˜¯ä¸º Kubernetes v1.11+å…¼å®¹æ€§æµ‹è¯•è€Œå¼€å‘çš„ã€‚å®‰è£…è¯´æ˜å¯åœ¨[`kind.sigs.k8s.io/`](https://kind.sigs.k8s.io/)æ‰¾åˆ°ã€‚

è™½ç„¶è¿™äº›å·¥å…·ç®€åŒ–äº† Kubernetes çš„éƒ¨ç½²åˆ°ä¸€ä¸ª CLI å‘½ä»¤ï¼Œå¹¶æä¾›äº†å¾ˆå¥½çš„ä½“éªŒï¼Œä½† minikube ä»ç„¶æ˜¯å¼€å§‹ä½¿ç”¨ Kubernetes çš„æœ€å®‰å…¨é€‰æ‹©ã€‚å¾—ç›Šäºè™šæ‹ŸåŒ–æ”¯æŒçš„æ‰€æœ‰å¹³å°ï¼Œä»¥åŠä¸€å¥—å‡ºè‰²çš„å¼€å‘è€…ç”Ÿäº§åŠ›åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ä¸ªé€‚åˆåˆå­¦è€…å’Œä¸“å®¶çš„å‡ºè‰²å·¥å…·ã€‚æœ¬ä¹¦ä¸­çš„æ‰€æœ‰ç»ƒä¹ å’Œç¤ºä¾‹éƒ½ä¾èµ–äº minikubeã€‚

## A.1 ä¸ Kubernetes ä¸€èµ·å·¥ä½œçš„å…ˆå†³æ¡ä»¶

ä¸ Kubernetes ä¸€èµ·å·¥ä½œæ‰€éœ€çš„å·¥å…·å’Œå®ç”¨ç¨‹åºã€‚

é™¤äº† Kubernetes æœ¬èº«ï¼Œä½ è¿˜éœ€è¦å®‰è£… kubectlã€‚kubectl æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ä¸ Kubernetes æ§åˆ¶å¹³é¢äº¤äº’ï¼Œå¹¶å‡ ä¹å¯ä»¥æ‰§è¡Œä¸ Kubernetes ç›¸å…³çš„ä»»ä½•æ“ä½œã€‚

### A.1.1 é…ç½® kubectl

è¦å¼€å§‹ï¼Œè¯·æŒ‰ç…§ [`kubernetes.io/docs/tasks/tools/install-kubectl/`](https://kubernetes.io/docs/tasks/tools/install-kubectl/) ä¸­çš„è¯´æ˜å®‰è£… minikubeã€‚å¦‚æœä½ æ˜¯ macOS æˆ– Linux ç”¨æˆ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ Homebrew è½¯ä»¶åŒ…ç®¡ç†å™¨å’Œä»¥ä¸‹å‘½ä»¤ä¸€æ­¥å®Œæˆå®‰è£…è¿‡ç¨‹ï¼š

```
$ brew install kubectl
```

Homebrew Homebrew æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºè½¯ä»¶åŒ…ç®¡ç†ç³»ç»Ÿï¼Œå®ƒç®€åŒ–äº†åœ¨ Apple çš„ macOS æ“ä½œç³»ç»Ÿå’Œ Linux ä¸Šçš„è½¯ä»¶å®‰è£…ã€‚æ›´å¤šä¿¡æ¯å¯åœ¨ [`brew.sh/`](https://brew.sh/) æ‰¾åˆ°ã€‚

## A.2 å®‰è£… minikube å’Œåˆ›å»ºé›†ç¾¤

Minikube æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…è®¸ä½ åœ¨æ¡Œé¢æˆ–ç¬”è®°æœ¬ç”µè„‘ä¸Šè¿è¡Œå•ä¸ªèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ã€‚å®‰è£…è¯´æ˜å¯åœ¨ [`kubernetes.io/docs/tasks/tools/install-minikube/`](https://kubernetes.io/docs/tasks/tools/install-minikube/) æ‰¾åˆ°ã€‚

æœ¬ä¹¦ä¸­çš„å¤§å¤šæ•°ï¼ˆä½†å¹¶éå…¨éƒ¨ï¼‰ç»ƒä¹ éƒ½å¯ä»¥ä½¿ç”¨æœ¬åœ° minikube é›†ç¾¤å®Œæˆã€‚

### A.2.1 é…ç½® minikube

ä¸‹ä¸€æ­¥æ˜¯å®‰è£…å¹¶å¯åŠ¨ minikube é›†ç¾¤ã€‚å®‰è£…è¿‡ç¨‹åœ¨ [`minikube.sigs.k8s.io/docs/start/`](https://minikube.sigs.k8s.io/docs/start/) ä¸­æè¿°ã€‚minikube è½¯ä»¶åŒ…ä¹Ÿé€šè¿‡ Homebrew æä¾›ï¼š

```
$ brew install minikube
```

å¦‚æœåˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬å°±å‡†å¤‡å¥½å¯åŠ¨ minikube å¹¶é…ç½®æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªéƒ¨ç½²ï¼š

```
$ minikube start 
minikube/default)
ğŸ˜  minikube v1.1.1 on darwin (amd64)
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...
ğŸ³  Configuring environment for Kubernetes v1.14.3 on Docker 18.09.6
ğŸšœ  Pulling images ...
ğŸš€  Launching Kubernetes ...
â³  Verifying: apiserver proxy etcd scheduler controller dns
ğŸ„  Done! kubectl is now configured to use "minikube"
```

## A.3 åœ¨ GCP ä¸­åˆ›å»º GKE é›†ç¾¤

Google Cloud Platform (GCP) æä¾›äº† Google Kubernetes Engine (GKE) ä½œä¸ºå…¶å…è´¹å±‚çš„ä¸€éƒ¨åˆ†ï¼š

[`cloud.google.com/free/`](https://cloud.google.com/free/)

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª Kubernetes GKE é›†ç¾¤æ¥è¿è¡Œæœ¬ä¹¦ä¸­çš„ç»ƒä¹ ï¼š

[`cloud.google.com/kubernetes-engine/`](https://cloud.google.com/kubernetes-engine/)

è¯·è®°ä½ï¼Œå°½ç®¡ GKE æœ¬èº«æ˜¯å…è´¹çš„ï¼Œä½†ä½ å¯èƒ½ä¼šå› ä¸º Kubernetes åˆ›å»ºçš„å…¶ä»– GCP èµ„æºè€Œè¢«æ”¶è´¹ã€‚å»ºè®®ä½ åœ¨å®Œæˆæ¯ä¸ªç»ƒä¹ ååˆ é™¤æµ‹è¯•é›†ç¾¤ï¼Œä»¥é¿å…æ„å¤–è´¹ç”¨ã€‚

## A.4 åœ¨ AWS ä¸­åˆ›å»º EKS é›†ç¾¤

Amazon Web Services (AWS) æä¾›äº†ä¸€ä¸ªåä¸º Elastic Kubernetes Service (EKS) çš„æ‰˜ç®¡ Kubernetes æœåŠ¡ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå…è´¹çš„ AWS è´¦æˆ·å¹¶åˆ›å»ºä¸€ä¸ª EKS é›†ç¾¤æ¥è¿è¡Œæœ¬ä¹¦ä¸­çš„ç»ƒä¹ ã€‚ç„¶è€Œï¼Œå°½ç®¡ç›¸å¯¹ä¾¿å®œï¼ŒEKS å¹¶éå…è´¹æœåŠ¡ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶æ¯å°æ—¶æ”¶è´¹ 0.20 ç¾å…ƒï¼‰ï¼Œä½ å¯èƒ½ä¼šå› ä¸º Kubernetes åˆ›å»ºçš„å…¶ä»–èµ„æºè€Œè¢«æ”¶è´¹ã€‚å»ºè®®ä½ åœ¨å®Œæˆæ¯ä¸ªç»ƒä¹ ååˆ é™¤æµ‹è¯•é›†ç¾¤ï¼Œä»¥é¿å…æ„å¤–è´¹ç”¨ã€‚

Weaveworks æœ‰ä¸€ä¸ªåä¸º `eksctl` çš„å·¥å…·ï¼Œå…è®¸ä½ è½»æ¾åœ°åœ¨ AWS è´¦æˆ·ä¸­åˆ›å»º EKS Kubernetes é›†ç¾¤ï¼š

[`github.com/weaveworks/eksctl/blob/master/README.md`](https://github.com/weaveworks/eksctl/blob/master/README.md)
